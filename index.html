<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href='https://cdn.jsdelivr.net/npm/@pelagiccreatures/tropicbird/dist/bundle.css' rel='stylesheet'>

<style>
	.error { color: red }
</style>

<script src="https://www.google.com/recaptcha/api.js?render=6Lf9JcsUAAAAAIj22YtqvAcP3xScEXheQN76zKro"></script>
<script type="module" src="https://cdn.jsdelivr.net/npm/@pelagiccreatures/sargasso/dist/sargasso.es.js"></script>
<script type="module" src="https://cdn.jsdelivr.net/npm/@pelagiccreatures/tropicbird/dist/tropicbird.es.js"></script>
<script type="module" src='./dist/molamola.es.js'></script>

<form id="test-form"  action="/form-post" method="POST" data-submitter=".submitter" data-status=".status" data-recaptcha="6Lf9JcsUAAAAAIj22YtqvAcP3xScEXheQN76zKro">
	<div class="input-group">
		<input type="text" name="one" placeholder="field one" data-validate='{"isEmail":true,"isLength":[1]}'>
		<span class="input-errors"></span>
	</div>
	<div class="input-group">
		<input type="text" name="two" placeholder="field two" data-validate='{"isLength":[5]}' data-lookup-endpoint="/lookup" data-unique>
		<span class="input-errors"></span>
	</div>
	<div class="input-group">
		<select name="select" data-validate='{"isLength":[1]}'>
			<option value="">---</option>
			<option value="val 1">val 1</option>
			<option value="val 2">val 2</option>
		</select>
		<span class="input-errors"></span>
	</div>
	<div class="input-group">
		<select name="select-multiple" data-validate='{"isLength":[1]}' multiple>
			<option value="">---</option>
			<option value="val 1">val 1</option>
			<option value="val 2">val 2</option>
		</select>
		<span class="input-errors"></span>
	</div>

	<button class="submitter">submit</button>
	<p class="status"></p>
</form>

<script type='module'>
	let loadPage = bootSargasso({hijax:{}})
	let tropicBird = new TropicBird(document.body, {})
	tropicBird.start()

	class boilerplateHandler extends MolaMolaHelper {
		success (data) {
			if (data.didLogin) {
				tropicBird.pushSnackBar('info','Logged in')
			}
			if (data.didLogout) {
				tropicBird.pushSnackBar('info','Logged out')
			}
			if( data.message) {
				tropicBird.pushSnackBar('info',data.message)
			}
			if (data.errors) {
				for(let i = 0; i < data.errors.length; i++){
					tropicBird.pushSnackBar(data['error-level'] || 'info', data.errors[i])
				}
			}
			if (data.status === 'ok' && data.redirect) {
				loadPage(data.redirect)
			}
		}

		error (err) {
			tropicBird.pushSnackBar('error',err.message)
		}
	}

	let form = new MolaMola(document.getElementById('test-form'))
	registerMolaMolaHelper('test-form', new boilerplateHandler(form))
	form.start()

</script>

<div class="mdc-snackbar">
	<div class="mdc-snackbar__surface">
		<div class="mdc-snackbar__label">
		</div>
	</div>
</div>
